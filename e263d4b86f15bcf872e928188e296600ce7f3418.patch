From e263d4b86f15bcf872e928188e296600ce7f3418 Mon Sep 17 00:00:00 2001
From: Pramurta Sinha <contact@b31ngd3v.eu.org>
Date: Thu, 17 Aug 2023 15:48:40 +0530
Subject: [PATCH] feat: add triage input option

---
 README.md           | 4 ++++
 action.yml          | 4 ++++
 src/cve_bin_tool.py | 4 ++++
 src/scanner.py      | 6 ++++++
 4 files changed, 18 insertions(+)

diff --git a/README.md b/README.md
index e0e420d..65a2252 100644
--- a/README.md
+++ b/README.md
@@ -42,6 +42,10 @@ NOTE: To mention multiple directories, use comma as a separator and don't includ
 
 **Optional** Valid SBOM formats are tag, json, yaml. (default: json)
 
+### `triage_input_file`
+
+**Optional** Provide input filename for triage data. The supported format is CycloneDX VEX. Find more information [here](https://github.com/intel/cve-bin-tool#providing-triage-input).
+
 ## Example usage
 
 ```yaml
diff --git a/action.yml b/action.yml
index 681fe92..a887b7c 100644
--- a/action.yml
+++ b/action.yml
@@ -28,6 +28,9 @@ inputs:
     required: false
     default: false
     description: 'Split security alerts based on source file.'
+  triage_input_file:
+    required: false
+    description: 'Provide input filename for triage data.'
 runs:
   using: 'composite'
   steps:
@@ -55,6 +58,7 @@ runs:
         --sbom-type '${{ inputs.sbom_type }}'
         --sbom-format '${{ inputs.sbom_format }}'
         --alerts-based-on-file '${{inputs.alerts_based_on_file}}'
+        --triage-input-file '${{ inputs.triage_input_file }}'
       shell: bash
     - uses: actions/upload-artifact@v3
       with:
diff --git a/src/cve_bin_tool.py b/src/cve_bin_tool.py
index d0a9d97..c2fc349 100644
--- a/src/cve_bin_tool.py
+++ b/src/cve_bin_tool.py
@@ -40,6 +40,7 @@ def scan(
         sbom_type=None,
         sbom_format="json",
         sbom_output="SBOM.json",
+        triage_input_file=None,
     ):
         json_data = []
         captured_output = ""
@@ -70,6 +71,9 @@ def scan(
                 command.append(sbom_format)
                 command.append("--sbom-output")
                 command.append(sbom_output)
+            if triage_input_file and Path(triage_input_file).exists():
+                command.append("--triage-input-file")
+                command.append(triage_input_file)
             captured_output += subprocess.run(
                 command, capture_output=True, text=True
             ).stdout
diff --git a/src/scanner.py b/src/scanner.py
index 16a4fe7..15ea43b 100644
--- a/src/scanner.py
+++ b/src/scanner.py
@@ -66,6 +66,11 @@ def main():
         help="Split security alerts based on source file.",
         required=False,
     )
+    parser.add_argument(
+        "--triage-input-file",
+        help="Provide input filename for triage data.",
+        required=False,
+    )
 
     args = parser.parse_args()
 
@@ -104,6 +109,7 @@ def main():
         sbom_type=args.sbom_type,
         sbom_format=args.sbom_format,
         sbom_output=f"{args.sbom_output}.{output_extension}",
+        triage_input_file=args.triage_input_file,
     )
 
     gen_sarif = GenerateSarif(
